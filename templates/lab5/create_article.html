
{% extends "base.html" %}

{% block lab %}Создание статьи{% endblock %}

{% block main %}
<div class="page-header">
    <h1><i class="fas fa-plus-circle"></i> Создание статьи</h1>
    <p>Заполните форму для создания новой статьи</p>
</div>

<div class="card">
    {% if error %}
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
            <strong>Ошибка!</strong> {{ error }}
        </div>
    </div>
    {% endif %}

    <form method="post" id="articleForm">
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-heading"></i> Название статьи
            </label>
            <input type="text" 
                   name="title" 
                   maxlength="50" 
                   class="form-control" 
                   placeholder="Введите заголовок статьи (до 50 символов)"
                   required>
            <div style="font-size: 0.85rem; color: var(--gray-color); margin-top: 0.25rem;">
                <i class="fas fa-info-circle"></i> Будет видно в списке статей
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-align-left"></i> Текст статьи
            </label>
            <textarea name="article_text" 
                      rows="10" 
                      class="form-control" 
                      placeholder="Введите содержание вашей статьи..."
                      required
                      style="resize: vertical; min-height: 200px; font-family: 'Inter', sans-serif;"></textarea>
            <div style="font-size: 0.85rem; color: var(--gray-color); margin-top: 0.25rem;">
                <i class="fas fa-info-circle"></i> Поддерживается форматирование текста
            </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
            <button type="submit" class="btn" style="background: var(--primary-color);">
                <i class="fas fa-check"></i> Создать статью
            </button>
            <a href="/lab5/list" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Отмена
            </a>
            <button type="button" class="btn" style="background: var(--light-color); color: var(--dark-color);" onclick="previewArticle()">
                <i class="fas fa-eye"></i> Предпросмотр
            </button>
        </div>
    </form>
</div>

<!-- Модальное окно предпросмотра -->
<div id="previewModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
    <div class="card" style="width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin: 0; color: var(--secondary-color);">
                <i class="fas fa-eye"></i> Предпросмотр статьи
            </h2>
            <button onclick="closePreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-color);">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="previewContent"></div>
        
        <div style="margin-top: 1.5rem; text-align: center;">
            <button onclick="closePreview()" class="btn btn-secondary">
                <i class="fas fa-times"></i> Закрыть
            </button>
        </div>
    </div>
</div>

<script>
function previewArticle() {
    const title = document.querySelector('input[name="title"]').value || 'Без названия';
    const text = document.querySelector('textarea[name="article_text"]').value || 'Текст статьи отсутствует';
    
    const previewContent = document.getElementById('previewContent');
    previewContent.innerHTML = `
        <div style="background: var(--light-color); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
            <h3 style="margin: 0 0 1rem 0; color: var(--secondary-color);">
                <i class="fas fa-file-alt"></i> ${title}
            </h3>
            <div style="white-space: pre-wrap; line-height: 1.6; background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e1e5eb;">
                ${text}
            </div>
        </div>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
            <div style="background: #f0f8ff; padding: 0.75rem 1.5rem; border-radius: var(--border-radius);">
                <i class="fas fa-ruler-combined"></i> ${text.length} символов
            </div>
            <div style="background: #f0f8ff; padding: 0.75rem 1.5rem; border-radius: var(--border-radius);">
                <i class="fas fa-clock"></i> Время чтения: ${Math.ceil(text.length / 1200)} мин
            </div>
        </div>
    `;
    
    document.getElementById('previewModal').style.display = 'flex';
}

function closePreview() {
    document.getElementById('previewModal').style.display = 'none';
}

// Закрытие модального окна по клику вне его
document.getElementById('previewModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closePreview();
    }
});
</script>

<style>
#previewModal .card {
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}
</style>
{% endblock %}
